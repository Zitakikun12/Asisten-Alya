<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alya - Asisten Pribadi Rezky</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0e1018 0%, #1a1d29 100%);
      color: #e0e0e0;
      padding: 20px;
      text-align: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #ff5ca1;
      font-size: 2.2em;
      margin-bottom: 5px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    p {
      font-size: 0.95em;
      color: #aaa;
      margin-top: 0;
    }
    .alya-img {
      width: 180px;
      height: 180px;
      object-fit: cover;
      margin-top: 25px;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 6px 15px rgba(255, 92, 161, 0.3);
      border: 4px solid #ff5ca1;
    }
    textarea {
      width: 90%;
      height: 100px;
      padding: 12px;
      margin-top: 20px;
      background: #1b1f2d;
      color: #fff;
      border: 1px solid #444;
      border-radius: 12px;
      font-size: 1em;
      resize: none;
      transition: all 0.3s ease;
    }
    textarea:focus {
      outline: none;
      border-color: #ff5ca1;
      box-shadow: 0 0 10px rgba(255, 92, 161, 0.3);
    }
    button {
      margin-top: 15px;
      padding: 14px 35px;
      background: linear-gradient(90deg, #ff5ca1, #ff82bf);
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(255, 92, 161, 0.3);
    }
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(255, 92, 161, 0.4);
    }
    button:active {
      transform: translateY(-1px);
    }
    .response-box {
      margin-top: 25px;
      padding: 18px;
      background: #1a1d29;
      border-left: 4px solid #ff5ca1;
      border-radius: 12px;
      font-size: 1.1em;
      color: #c8e6c9;
      max-width: 90%;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
      text-align: left;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .typing-indicator {
      display: inline-block;
      margin-left: 5px;
    }
    .typing-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      background-color: #ff5ca1;
      border-radius: 50%;
      margin-right: 3px;
      animation: typingAnimation 1.4s infinite ease-in-out;
    }
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
    .schedule-box {
      margin-top: 20px;
      padding: 15px;
      background: #1b1f2d;
      border-radius: 12px;
      text-align: left;
      max-width: 90%;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .schedule-title {
      color: #ff5ca1;
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 1.1em;
    }
    .schedule-item {
      margin-bottom: 8px;
      display: flex;
    }
    .schedule-time {
      color: #ff82bf;
      min-width: 80px;
      font-weight: 500;
    }
    .schedule-activity {
      color: #e0e0e0;
    }
    .voice-recording {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 15px;
    }
    .voice-btn {
      background: #ff5ca1;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin: 0 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(255, 92, 161, 0.3);
    }
    .voice-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 92, 161, 0.5);
    }
    .voice-btn.recording {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 92, 161, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(255, 92, 161, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 92, 161, 0); }
    }
    .voice-status {
      color: #ff5ca1;
      font-size: 0.9em;
      margin-top: 8px;
    }
    .footer {
      margin-top: 30px;
      color: #666;
      font-size: 0.8em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üå∏ Alya - Asisten Pribadi Rezky</h1>
    <p>Alya akan membantumu tetap disiplin dengan jadwal Siap Kerja & Siap Tinggi~</p>
    <img class="alya-img" id="alya-avatar" src="https://placehold.co/180x180/ff5ca1/ffffff?text=ALYA" alt="Alya">

    <div class="response-box" id="status">üå∏ Alya siap membantumu hari ini!</div>

    <div class="schedule-box" id="current-schedule">
      <div class="schedule-title">‚è∞ Jadwal Saat Ini:</div>
      <div id="schedule-content">Memuat jadwal...</div>
    </div>

    <textarea id="input" placeholder="Tulis pesan untuk Alya di sini..."></textarea><br>
    <button onclick="kirimKeAlya()">Kirim ke Alya</button>
    
    <div class="voice-recording">
      <div class="voice-btn" id="voice-btn" title="Tekan dan tahan untuk merekam">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 1C10.3431 1 9 2.34315 9 4V12C9 13.6569 10.3431 15 12 15C13.6569 15 15 13.6569 15 12V4C15 2.34315 13.6569 1 12 1Z" fill="white"/>
          <path d="M5 11C5.55228 11 6 11.4477 6 12C6 15.3137 8.68629 18 12 18C15.3137 18 18 15.3137 18 12C18 11.4477 18.4477 11 19 11C19.5523 11 20 11.4477 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12C4 11.4477 4.44772 11 5 11Z" fill="white"/>
        </svg>
      </div>
    </div>
    <div class="voice-status" id="voice-status">Tekan dan tahan tombol untuk merekam</div>
    
    <div class="response-box" id="chat-result">üí¨ Percakapan akan muncul di sini...</div>

    <div class="footer">
      Dibuat dengan ‚ù§Ô∏è untuk Rezky
    </div>
  </div>

  <script>
    const alyaAvatar = document.getElementById('alya-avatar');
    const statusBox = document.getElementById('status');
    const chatResult = document.getElementById('chat-result');
    const inputField = document.getElementById('input');
    const sendButton = document.querySelector('button');
    const scheduleContent = document.getElementById('schedule-content');
    const voiceBtn = document.getElementById('voice-btn');
    const voiceStatus = document.getElementById('voice-status');
    
    let lastActivityTime = Date.now();
    let isUserActive = true;
    let currentController = null;
    let recognition;
    let isRecording = false;

    const jadwalHariSekolah = [
      { time: '06:00', activity: 'Olahraga: stretching + lompat tali + gantung di tiang' },
      { time: '06:30', activity: 'Mandi, sarapan, persiapan sekolah' },
      { time: '07:00', activity: 'Sekolah' },
      { time: '12:00', activity: 'Pulang, makan siang, istirahat' },
      { time: '13:30', activity: 'Review konsep cepat (HTML, CSS, JS, React)' },
      { time: '14:30', activity: 'Mini project / latihan coding (DOM, CRUD, react app)' },
      { time: '15:30', activity: 'Snack + relaksasi' },
      { time: '16:00', activity: 'Olahraga sore: pull-up + skipping + gantung bar' },
      { time: '16:30', activity: 'Latihan Python/AI/React Native/Game' },
      { time: '17:00', activity: 'Sholat + santai' },
      { time: '18:00', activity: 'Push GitHub + dokumentasi proyek' },
      { time: '19:00', activity: 'Hiburan + baca ulang kode ringan' },
      { time: '20:30', activity: 'Latihan algoritma atau soal interview' },
      { time: '23:14', activity: 'Tidur malam (maksimal jam 22:00)' }
    ];

    const jadwalAkhirPekan = [
      { time: '08:00', activity: 'Stretching + lompat + gantung tiang' },
      { time: '08:30', activity: 'Studi kasus login, file handling, API call' },
      { time: '09:30', activity: 'Istirahat ringan' },
      { time: '10:00', activity: 'Kerjakan soal logika atau latihan React/Node' },
      { time: '13:00', activity: 'Portofolio proyek nyata (Web, Game, App)' },
      { time: '15:00', activity: 'Relaksasi / main game' },
      { time: '16:00', activity: 'Olahraga: Skipping + Hanging bar' },
      { time: '16:30', activity: 'Debug, revisi proyek, latihan AI/chatbot' },
      { time: '19:00', activity: 'Update GitHub, CV, LinkedIn, dokumentasi' },
      { time: '21:00', activity: 'Evaluasi mingguan + rencana minggu depan' }
    ];

    function updateAvatar(emosi) {
      const colors = {
        happy: '#ff5ca1',
        sad: '#ff2e7a',
        excited: '#ff2e7a',
        neutral: '#ff5ca1',
        love: '#ff2e7a',
        thinking: '#ff82bf'
      };
      
      alyaAvatar.style.borderColor = colors[emosi] || colors.neutral;
      alyaAvatar.style.transform = 'scale(1.1)';
      setTimeout(() => { alyaAvatar.style.transform = 'scale(1)'; }, 300);
    }

    function showTypingIndicator() {
      chatResult.innerHTML = 'Alya sedang mengetik<span class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></span>';
    }

    function cekAktivitasUser() {
      const now = Date.now();
      isUserActive = (now - lastActivityTime) < 1800000;
      setTimeout(cekAktivitasUser, 300000);
    }

    function initVoiceRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        voiceStatus.textContent = "Browser tidak mendukung pengenalan suara";
        voiceBtn.style.display = 'none';
        return;
      }
      
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'id-ID';
      
      voiceBtn.addEventListener('mousedown', startRecording);
      voiceBtn.addEventListener('touchstart', startRecording);
      voiceBtn.addEventListener('mouseup', stopRecording);
      voiceBtn.addEventListener('touchend', stopRecording);
      voiceBtn.addEventListener('mouseleave', stopRecording);
      
      recognition.onstart = () => {
        isRecording = true;
        voiceBtn.classList.add('recording');
        voiceStatus.textContent = "Merekam...";
        updateAvatar('thinking');
      };
      
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        inputField.value = transcript;
        voiceStatus.textContent = "Suara berhasil dikenali";
      };
      
      recognition.onerror = (event) => {
        voiceStatus.textContent = "Error: " + event.error;
        stopRecording();
      };
      
      recognition.onend = () => {
        stopRecording();
      };
    }
    
    function startRecording(e) {
      e.preventDefault();
      if (isRecording) return;
      
      try {
        recognition.start();
      } catch (error) {
        voiceStatus.textContent = "Error memulai rekaman: " + error.message;
      }
    }
    
    function stopRecording() {
      if (!isRecording) return;
      
      try {
        recognition.stop();
      } catch (error) {
        console.error("Error menghentikan rekaman:", error);
      }
      
      isRecording = false;
      voiceBtn.classList.remove('recording');
      
      if (voiceStatus.textContent === "Merekam...") {
        voiceStatus.textContent = "Tekan dan tahan tombol untuk merekam";
      }
    }

    function getCurrentSchedule() {
      const now = new Date();
      const day = now.getDay();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const currentTime = `${hours}:${minutes}`;
      
      const isWeekday = day >= 1 && day <= 5;
      const schedule = isWeekday ? jadwalHariSekolah : jadwalAkhirPekan;
      
      let currentActivity = null;
      let nextActivity = null;
      
      for (let i = 0; i < schedule.length; i++) {
        if (schedule[i].time >= currentTime) {
          nextActivity = schedule[i];
          currentActivity = i > 0 ? schedule[i-1] : null;
          break;
        }
      }
      
      if (!nextActivity) {
        nextActivity = schedule[0];
        currentActivity = schedule[schedule.length - 1];
      }
      
      return {
        current: currentActivity,
        next: nextActivity,
        isWeekday
      };
    }

    function updateScheduleDisplay() {
      const schedule = getCurrentSchedule();
      let html = '';
      
      if (schedule.current) {
        html += `<div class="schedule-item">
          <span class="schedule-time">${schedule.current.time}</span>
          <span class="schedule-activity">${schedule.current.activity}</span>
        </div>`;
      }
      
      if (schedule.next) {
        html += `<div class="schedule-item">
          <span class="schedule-time">${schedule.next.time}</span>
          <span class="schedule-activity">${schedule.next.activity} (selanjutnya)</span>
        </div>`;
      }
      
      scheduleContent.innerHTML = html;
    }

    function analyzeMood(text) {
      if (!text || typeof text !== 'string') return 'neutral';
      
      const lowerText = text.toLowerCase();
      const happyWords = ['senang', 'happy', 'joy', 'üòä', 'üòÑ', 'good', 'bagus'];
      const sadWords = ['sedih', 'sad', 'üò¢', 'üòî', 'bad', 'buruk'];
      const loveWords = ['love', 'sayang', '‚ù§Ô∏è', 'üòç', 'rindu'];
      const excitedWords = ['!', 'wow', 'üò≤', 'üéâ', 'hebat', 'keren'];
      
      if (happyWords.some(word => lowerText.includes(word))) return 'happy';
      if (sadWords.some(word => lowerText.includes(word))) return 'sad';
      if (loveWords.some(word => lowerText.includes(word))) return 'love';
      if (excitedWords.some(word => lowerText.includes(word))) return 'excited';
      
      return 'neutral';
    }

    function processResponse(data) {
      if (!data) return "Maaf, tidak ada respons dari Alya";
      
      if (typeof data.result === 'string') return data.result;
      if (data.result?.message) return data.result.message;
      if (data.message) return data.message;
      
      try {
        return JSON.stringify(data.result || data);
      } catch {
        return "Alya memberikan respons yang tidak dikenali";
      }
    }

    async function kirimKeAlya() {
      if (currentController) currentController.abort();
      
      const inputText = inputField.value.trim();
      if (!inputText) {
        chatResult.textContent = "‚ùå Pesan tidak boleh kosong";
        updateAvatar('sad');
        return;
      }

      sendButton.disabled = true;
      lastActivityTime = Date.now();
      showTypingIndicator();
      updateAvatar('thinking');
      inputField.value = '';

      currentController = new AbortController();
      const timeoutId = setTimeout(() => currentController.abort(), 10000);

      try {
        // ENDPOINT API YANG TELAH DIUBAH
        const response = await fetch(
          `https://zelapioffciall.koyeb.app/ai/chatgpt?prompt=Helo&content=${encodeURIComponent(inputText)}`,
          { signal: currentController.signal }
        );
        
        clearTimeout(timeoutId);
        
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        
        const data = await response.json();
        const jawaban = processResponse(data);
        
        chatResult.innerHTML = `üí¨ <strong>Alya:</strong><br>${jawaban}`;
        
        const mood = analyzeMood(jawaban);
        updateAvatar(mood);
        
      } catch (error) {
        clearTimeout(timeoutId);
        
        if (error.name === 'AbortError') {
          chatResult.textContent = "‚ùå Permintaan waktu habis. Coba lagi ya~";
        } else {
          console.error("Error:", error);
          chatResult.textContent = "‚ùå Alya sedang tidak bisa dihubungi. Coba lagi nanti ya~";
        }
        updateAvatar('sad');
      } finally {
        sendButton.disabled = false;
        currentController = null;
      }
    }

    function init() {
      updateAvatar('happy');
      cekAktivitasUser();
      updateScheduleDisplay();
      initVoiceRecognition();
      
      document.addEventListener('mousemove', () => lastActivityTime = Date.now());
      document.addEventListener('keydown', () => lastActivityTime = Date.now());
      
      inputField.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          kirimKeAlya();
        }
      });
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>